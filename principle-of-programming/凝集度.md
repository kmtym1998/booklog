# 4.1 凝集度

## とは
- モジュールに含まれる機能の純粋さ
- レベルは 7 つ。高ければ高いほど凝集度が高い = 強く、よいモジュール

### 1. 暗合的強度
- モジュール内の要素に特別の関係が認められない
  - 暗合: 偶然に物事が一致する
- 例
  - たまたまモジュール内に重複している命令のパターンがあったので一つにしてみた
  - → この場合、命名が正しくできないはず。互いに関連性はないから。
  - (変更理由が違う。コンテキストが違う)
- モジュールの機能を正しく定義できないと、再利用ができない。凝集度が低い。

### 2. 論理的強度
- ある機能を抽象的に捉えてまとめたもの
- 関連したいくつかの機能を含み、そのうちの1つの呼び出しがモジュールによって識別される
  - 例: https://speakerdeck.com/moriatsushi/liang-ikodotohahe-ka-enziniaxin-zu-yan-xiu-suraidogong-kai?slide=37
- 👍
  - 機能的には共通するものを含んでいるから一部ロジックを共通化できるかも
  - プログラマの思考を集中させられる
  - 特定のデータの処理を1つのモジュールに局所化させる (=情報隠蔽ができる)
- 👎
  - 複数個の機能に対して同一のものを使用するから、パラメータの取り扱いで事故りやすい
  - 実行される命令はすべてではないから、関連性は弱く、モジュール強度は低い

### 3. 時間的強度
- 特定の時間に連続して実行する複数の機能を1つのモジュールにまとめたもの
- 初期化処理が代表的
  - 例: https://speakerdeck.com/moriatsushi/liang-ikodotohahe-ka-enziniaxin-zu-yan-xiu-suraidogong-kai?slide=38

### 4. 手順的強度
- 問題を処理するために依存している複数個の処理のいくつかを実行するモジュール
  - 大きな手順の一部分を切り出したモジュールはこれに当たる
  - 複雑なフローチャートの一部を切り出した場合など
- 手順的強度を持つモジュールは、基本的に時間的強度をもつ
- 機能間に手順的な関連性があるので、時間的強度より強度は高い
- 複数機能の中の1つだけ必要といった時に使えなくなる
  - ↑ をやるには機能選択が必要
  - そうすると、論理的強度になるので強度が落ちる

### 5. 連絡的強度
- モジュール内の機能でデータの受け渡しをしたり、同じデータを参照する
- 基本的に手順的強度を持つ
- データでつながっている文手順的強度より凝集度が高い
- 例: https://speakerdeck.com/moriatsushi/liang-ikodotohahe-ka-enziniaxin-zu-yan-xiu-suraidogong-kai?slide=40

### 6. 情報的強度
- 特定のデータ構造を扱う複数の機能を1つのモジュールにまとめたもの
- 同一データ構造はできるだけ特定のモジュールだけでアクセスする
- データ構造の修正時の影響が閉じられる

### 7. 機能的強度
- モジュール内のすべてが1つの役割を実行するために関連しあっている
- 変更頻度がモジュール全体を通して共通である
- 他のモジュールへの影響もこれより下の強度しか満たさないモジュールに比べて低い

## なぜ重要か？
- コードはモジュールに分割することで統治が可能、という前提
- 独立性はコードの複雑さを減少させ、結果としてコードの信用性を高める → 保守しやすさ
- 独立性を高めるには?
  - それぞれのモジュール**内**で関連性が最大になるように
  - モジュール**間**で関連性が最小になるように
- モジュール**内**での関連性のメトリクスとしてモジュール自身の関連性の強さを図るのが凝集度

## どうやる？
- 機能的強度モジュールを目指す
- 特定のデータ処理を局所化できるメリットを評価すれば、情報的強度モジュールの価値は高い
- 機能的強度、情報的強度にできないことはあるからそれはしょうがない
  - そこに行き着くためにどういう判断をしたか、どれだけ代替案を検討したかのプロセスが重要

## 所感
- 似たトピックのスライド。同じ凝集度の話をしていたので例のところでも使った
- https://speakerdeck.com/moriatsushi/liang-ikodotohahe-ka-enziniaxin-zu-yan-xiu-suraidogong-kai
- なかなか難しい概念だけど、ちゃんと落とし込めたらレビュー速度・コーディング速度上がりそう
- 「関数に切り出してください」「別クラスに切り出してください」の根拠とすべきところだと思いました
